# ~/.config/tmux/tmux.conf
# Functional status bar with Dracula theme

# ── General ────────────────────────────────────────────
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"
set -ag terminal-overrides ",*:Smulx=\E[4::%p1%dm"  # undercurl support
set -ag terminal-overrides ",*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m"  # underline color

set -g mouse on
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on
set -g history-limit 50000
set -g status-interval 5
set -g escape-time 0
set -g focus-events on
set -g set-clipboard on

# ── Prefix ─────────────────────────────────────────────
# Keep default C-b, add C-a as secondary
set -g prefix C-b
set -g prefix2 C-a

# Reload config
bind r source-file ~/.config/tmux/tmux.conf \; display "Config reloaded"

# ── Pane splitting ─────────────────────────────────────
bind | split-window -h -c "#{pane_current_path}"
bind -- - split-window -v -c "#{pane_current_path}"
bind c new-window -c "#{pane_current_path}"

# Vim-style pane navigation (prefix + h/j/k/l)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Prefix-free pane navigation (Alt + h/j/k/l)
bind -n M-h select-pane -L
bind -n M-j select-pane -D
bind -n M-k select-pane -U
bind -n M-l select-pane -R

# Pane resizing (prefix + H/J/K/L, repeatable)
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Window navigation (Alt + [/])
bind -n M-[ previous-window
bind -n M-] next-window

# Swap panes (prefix + </>)
bind -r < swap-pane -U
bind -r > swap-pane -D

# ── Dracula Colors ─────────────────────────────────
# bg:               #282a36
# current_line:     #44475a
# fg:               #f8f8f2
# comment:          #6272a4
# cyan:             #8be9fd
# green:            #50fa7b
# orange:           #ffb86c
# pink:             #ff79c6
# purple:           #bd93f9
# red:              #ff5555
# yellow:           #f1fa8c

# ── Status Bar ─────────────────────────────────────────
set -g status-position bottom
set -g status-style "bg=default,fg=#f8f8f2"

# Left: [session:window] directory git-branch
set -g status-left-length 80
set -g status-left "#[fg=#282a36,bg=#50fa7b,bold] #S:#I #[fg=#50fa7b,bg=#282a36] #[fg=#8be9fd]#{=/30/…:#{s|$HOME|~|:pane_current_path}} #(~/.config/tmux/scripts/git-info.sh '#{pane_current_path}') #[fg=#6272a4]│ "

# Right: claude-status | sys-info | time
set -g status-right-length 120
set -g status-right "#(~/.config/tmux/scripts/claude-status.sh) #[fg=#6272a4]│ #(~/.config/tmux/scripts/sys-info.sh) #[fg=#6272a4]│ #[fg=#bd93f9]%H:%M "

# ── Window Tabs ────────────────────────────────────────
set -g window-status-format "#[fg=#6272a4] #I:#W "
set -g window-status-current-format "#[fg=#282a36,bg=#ffb86c,bold] #I:#W "
set -g window-status-separator ""

# ── Active Pane Distinction ────────────────────────────
# Border: dim for inactive, cyan+bold for active
set -g pane-border-style "fg=#6272a4"
set -g pane-active-border-style "fg=#8be9fd,bold"

# Border labels with pane index
set -g pane-border-format " #{?pane_active,#[fg=#8be9fd]●,#[fg=#6272a4]○} #P "
set -g pane-border-status top

# Dim inactive panes (active=full brightness, inactive=slightly darker)
set -g window-style "bg=default"
set -g window-active-style "bg=default"

# ── Messages ───────────────────────────────────────────
set -g message-style "bg=default,fg=#f8f8f2"
set -g message-command-style "bg=default,fg=#f8f8f2"

# ── Vi Copy Mode ──────────────────────────────────────
setw -g mode-keys vi
setw -g mode-style "bg=#44475a,fg=#f8f8f2"

# Enter copy mode: prefix + v (like vim visual)
bind v copy-mode

# Vi-style selection and yank
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi V send-keys -X select-line
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
bind -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "pbcopy"

# Vi-style navigation in copy mode
bind -T copy-mode-vi H send-keys -X start-of-line
bind -T copy-mode-vi L send-keys -X end-of-line

# Incremental search
bind -T copy-mode-vi / command-prompt -i -p "(search down)" "send -X search-forward-incremental \"%%%\""
bind -T copy-mode-vi ? command-prompt -i -p "(search up)" "send -X search-backward-incremental \"%%%\""

# Paste buffer: prefix + p
bind p paste-buffer

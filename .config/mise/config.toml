# [env]

[settings]
experimental = true
idiomatic_version_file_enable_tools = []

[tasks.claude-bypass]
description = "Run Claude Code with bypass permissions"
run = "claude --dangerously-skip-permissions"

[tasks.claude-opus]
description = "Run Claude Code with Opus model"
run = "claude --model claude-opus-4-6"

[tasks.claude-sonnet]
description = "Run Claude Code with Sonnet model"
run = "claude --model claude-sonnet-4-5-20250929"

[tasks.claude-haiku]
description = "Run Claude Code with Haiku model"
run = "claude --model claude-haiku-4-5-20251001"

[tasks.claude-planner]
description = "Run Claude as planner (subscription, no API key)"
dir = "{{cwd}}"
run = "claude --dangerously-skip-permissions"

[tasks.claude-executor]
description = "Run Claude as executor (z.ai API key)"
dir = "{{cwd}}"
run = "~/.config/mise/tasks/zai/claude --dangerously-skip-permissions"

[tasks.claude-dual]
description = "Run executor + tester in tmux split (LEADER_ID=N)"
dir = "{{cwd}}"
run = """
LID="${LEADER_ID:-1}"
# 숫자 검증
if ! echo "$LID" | grep -qE '^[0-9]+$'; then echo "LEADER_ID must be numeric"; exit 1; fi
tmux rename-window "leader${LID}"
# dual{N}-{M} 형태: 기존 dual{N}-* 중 최대 M+1
MAX_M=$(tmux list-windows -F '#{window_name}' | sed -n "s/^dual${LID}-\\([0-9]\\{1,\\}\\)$/\\1/p" | sort -n | tail -1)
DM=$(( ${MAX_M:-0} + 1 ))
DNAME="dual${LID}-${DM}"
tmux new-window -n "$DNAME" -c "$PWD" "CLAUDE_LEADER_ID=${LID} ~/.config/mise/tasks/zai/claude --dangerously-skip-permissions"
tmux split-window -h -t "$DNAME" -c "$PWD" "CLAUDE_LEADER_ID=${LID} CLAUDE_ROLE=tester ~/.config/mise/tasks/zai/claude --dangerously-skip-permissions"
"""

[tasks.specs-status]
description = "Show EARS specs status for current project"
run = """
PROJECT=$(basename "$PWD")
SPECS_DIR="$HOME/.claude/specs/$PROJECT"
echo "=== Specs Status: $PROJECT ==="
for status in pending doing done; do
  count=$(ls "$SPECS_DIR/$status" 2>/dev/null | wc -l | tr -d ' ')
  echo "$status: $count"
  ls "$SPECS_DIR/$status" 2>/dev/null | sed 's/^/  /'
done
"""

[tools]
ripgrep = "latest"
node = "latest"
fzf = "latest"
watchexec = "latest"
bat = "latest"
just = "latest"
pnpm = "latest"
stylua = "latest"
shfmt = "latest"
python = "latest"
dust = "latest"
"npm:@openai/codex" = "latest"
jq = "latest"
java = "25"
maven = "3.9"
